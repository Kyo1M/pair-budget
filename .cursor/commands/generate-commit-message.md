---
description: ステージングされた変更からGitコミットメッセージを生成
globs: 
alwaysApply: false
---

# Gitコミットメッセージ生成

ステージングされた変更（または指定された差分）を分析し、Conventional Commits形式でコミットメッセージを作成してください。

## 言語指定

- `language = "ja"`
- サマリおよび本文は日本語で記述する
- 技術用語・固有名詞は英語のまま使用可

## 基本フォーマット（必須）

```
<Prefix>: <サマリ（命令形/簡潔に）>

- 変更内容1（箇条書き）
- 変更内容2（箇条書き）
- ...

Refs: #<Issue番号>（任意）
BREAKING CHANGE: <内容>（任意）
```

## Prefix（先頭プレフィックス）

Prefix は、Conventional Commits における `type` に相当し、小文字の英単語を使用します。

| Prefix | 用途 |
|--------|------|
| feat | 新機能の追加 |
| fix | バグ修正 |
| refactor | リファクタリング（挙動変更なし） |
| perf | パフォーマンス改善 |
| test | テスト追加/修正 |
| docs | ドキュメント更新 |
| build | ビルド/依存関係の変更 |
| ci | CI関連の変更 |
| chore | 雑務（ツール設定/スクリプト等） |
| style | スタイルのみの変更（コードロジック無関係） |
| revert | 取り消し |

スコープを指定する場合: `<Prefix>(scope): <サマリ>`
例: `fix(auth): ログイン時のトークン検証エラーを修正`

## サマリ（1行目）

- 日本語で簡潔に書く。末尾の句点は不要
- 何を・なぜ（必要なら）を短く表現
- 文字数はおおよそ50文字以内を目安に

## メッセージ生成の原則

- コミットメッセージは、必ず未コミットの差分（`git diff` / `git diff --cached` など）を確認したうえで、その内容からサマリと本文を生成する
- issue タイトルやブランチ名だけから推測して書かず、実際の差分に含まれる変更内容を要約・列挙する
- 差分を確認せずに推測でメッセージを作成してはいけない

## 本文（箇条書き）

- 変更点を「- 」ではじめる箇条書きで列挙
- 日本語で記述。必要に応じて技術用語は英単語可
- 可能なら「影響範囲」「移行手順」「リスク」「ロールバック方法」等も箇条書きで追記

## フッター（任意）

- Refs/Closes: 関連IssueやPRを `Refs: #123` / `Closes: #123` で明記
- BREAKING CHANGE: 後方互換を壊す変更がある場合は内容を明示（あるいは Prefix に `!` を付ける `fix!: ...` 記法を併用）

## 生成例

### 例1: ドキュメント更新

```
docs: ターゲットペルソナの詳細を追加

- ペルソナAの課題と目標を具体化
- 利用シナリオを3パターン追加
- 関連する仮説へのリンクを追記
```

### 例2: バグ修正

```
fix: 不要なデバッグログ出力を削除

- ユーザー情報取得処理の冗長なログ行を削除
- 必要な情報は残しつつログボリュームを削減

Refs: #123
```

### 例3: リファクタリング

```
refactor: 重複したバリデーション処理を共通関数へ集約

- フォーム入力チェックの重複コードをユーティリティ関数へ切り出し
- 呼び出し元の重複ロジックを削除し可読性を向上
- 挙動の変更はなし
```

### 例4: 破壊的変更

```
feat!: API認証方式をJWTに変更

- Bearer Token認証からJWT認証に移行
- 認証ミドルウェアを全面的に書き換え
- レスポンス形式を統一

BREAKING CHANGE: 既存のAPIキー認証は廃止。クライアントはJWTトークンを使用する必要あり
```

## 禁止事項

- 意味が伝わらない曖昧なサマリ（例: "update", "fix bug", "修正", "更新" 等の抽象的な表現）
- 箇条書きがなく、内容が把握しづらい長文だけの本文
- 静的解析や検査を無効化・迂回するだけで、実質的な改善を伴わない変更のコミット

---

## 実行手順

1. `git diff --cached` または `git diff` で変更差分を確認
2. 変更内容を分析し、適切なPrefixを選択
3. サマリを作成（50文字以内、日本語）
4. 変更点を箇条書きで列挙
5. 必要に応じてフッターを追加
6. コミットメッセージを出力
