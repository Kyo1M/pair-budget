<!-- 30f85695-14cb-4f9f-982a-aeb6f8ef7b65 4b603518-826c-46dd-a32c-e99c25c17dd8 -->
# 月次ビュー「最近の取引」欄の改善

## 現状の問題点

1. 「すべて表示」ボタンが機能していない（`onViewAll`がundefined）
2. 支出のみ表示されており、収入・精算が表示されていない
3. 取引の編集・削除ができない

## 実装内容

### 1. ドロップダウンメニューコンポーネントの追加

shadcn/uiの`dropdown-menu`コンポーネントをインストールし、各取引に三点リーダーメニューを追加します。

**ファイル**: `apps/web/src/components/ui/dropdown-menu.tsx`（新規作成）

### 2. 全履歴表示モーダルの作成

取引一覧を表示するモーダルを新規作成します。

**ファイル**: `apps/web/src/components/modals/AllTransactionsModal.tsx`（新規作成）

**機能**:

- 全取引を日付降順で表示（ページネーションまたは無限スクロール）
- タイプ別フィルター（すべて/支出/収入/立替）
- 各取引に編集・削除メニュー
- 取引タイプごとに色分け表示

### 3. 取引編集機能の追加

既存の`TransactionModal`を編集モードに対応させます。

**ファイル**: `apps/web/src/components/modals/TransactionModal.tsx`

**変更点**:

- `editingTransaction?: Transaction`プロパティを追加
- 編集モード時は既存データでフォームを初期化
- タイトルを「取引を編集」に変更
- 更新処理を実装

### 4. 取引更新サービスの追加

**ファイル**: `apps/web/src/services/transactions.ts`

**追加関数**:

```typescript
export async function updateTransaction(
  id: string,
  input: Partial<TransactionData>
): Promise<Transaction>
```

### 5. ストアに更新アクションを追加

**ファイル**: `apps/web/src/store/useTransactionStore.ts`

**追加メソッド**:

- `updateTransaction: (id: string, data: Partial<TransactionData>) => Promise<Transaction>`

### 6. RecentTransactionsコンポーネントの改善

**ファイル**: `apps/web/src/components/dashboard/RecentTransactions.tsx`

**変更点**:

- 各取引にドロップダウンメニュー（編集・削除）を追加
- タイプ別フィルターをカード右上に追加（すべて/支出/収入/立替）
- 収入・精算も色分けして表示（既に実装済み）
- `onViewAll`コールバックを実装

### 7. ページ側の統合

**ファイル**: `apps/web/src/app/page.tsx`

**変更点**:

- `AllTransactionsModal`の状態管理を追加
- `RecentTransactions`に`onViewAll`を渡す
- `TransactionModal`に編集対象の取引を渡せるようにする
- 編集・削除後のデータ再取得処理

## 追加提案

### タイプ別フィルター

`RecentTransactions`コンポーネントにフィルター機能を追加し、表示する取引タイプを切り替えられるようにします。デフォルトは「すべて」で、色分けして混在表示します。

### 削除確認ダイアログ

削除時に確認ダイアログを表示し、誤操作を防ぎます。

### 編集後の自動再読み込み

取引編集・削除後、月次サマリー、残高、年次データを自動的に再読み込みして整合性を保ちます。

## 実装順序

1. ドロップダウンメニューコンポーネントのインストール
2. 取引更新サービスとストアの実装
3. TransactionModalの編集モード対応
4. RecentTransactionsにメニューとフィルターを追加
5. AllTransactionsModalの作成
6. ページ側の統合とテスト

## 実装結果

### 完了日

2024年（実装完了）

### 実装内容

- ドロップダウンメニューコンポーネントの追加
- 取引更新機能の実装
- TransactionModalの編集モード対応
- RecentTransactionsのフィルター・メニュー追加
- AllTransactionsModalの作成
- ページ側の統合と編集・削除機能の実装

### 動作確認

- ✅ Lint 通過
- ✅ TypeScript コンパイル成功
- ✅ ビルド成功

### To-dos

- [x] shadcn/uiのdropdown-menuコンポーネントをインストール
- [x] transactions.tsにupdateTransaction関数を追加
- [x] useTransactionStoreにupdateTransactionアクションを追加
- [x] TransactionModalを編集モードに対応（editingTransactionプロパティ追加、フォーム初期化、更新処理）
- [x] RecentTransactionsにドロップダウンメニュー、タイプ別フィルター、編集・削除機能を追加
- [x] AllTransactionsModalを新規作成（全履歴表示、フィルター、編集・削除）
- [x] page.tsxにAllTransactionsModal統合、onViewAll実装、編集・削除後の再読み込み処理